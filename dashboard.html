<script>
const sheetId = "1Z5c8JLblRDl1gDwbGSUK1uL3-YZxA7-lJIPAuRwSwGg";
const sheetName = "Sheet1";
const url = `https://opensheet.elk.sh/${sheetId}/${sheetName}`;

fetch(url)
  .then(res => res.json())
  .then(data => {

    let totalQty = 0;
    let totalHarga = 0;

    let perHari = {};   // { "26/02/2026": 320000 }
    let perAdmin = {};  // { "apepopus": 320000 }

    data.forEach(row => {
      const tanggalFull = row["Tanggal"];
      const tanggal = tanggalFull.split(" ")[0];

      const qty = Number(row["Qty"]) || 0;
      const harga = Number(row["Total harga"]) || 0;
      const admin = row["Admin"] || "Unknown";

      totalQty += qty;
      totalHarga += harga;

      // rekap per hari
      if (!perHari[tanggal]) perHari[tanggal] = 0;
      perHari[tanggal] += harga;

      // rekap per admin
      if (!perAdmin[admin]) perAdmin[admin] = 0;
      perAdmin[admin] += harga;
    });

    // tampilkan total
    document.getElementById("totalQty").innerText = totalQty;
    document.getElementById("totalHarga").innerText =
      totalHarga.toLocaleString("id-ID");

    // === GRAFIK PER HARI ===
    new Chart(document.getElementById("chartHarian"), {
      type: "line",
      data: {
        labels: Object.keys(perHari),
        datasets: [{
          label: "Total Penjualan per Hari",
          data: Object.values(perHari)
        }]
      }
    });

    // === GRAFIK PER ADMIN ===
    new Chart(document.getElementById("chartAdmin"), {
      type: "bar",
      data: {
        labels: Object.keys(perAdmin),
        datasets: [{
          label: "Total Penjualan per Admin",
          data: Object.values(perAdmin)
        }]
      }
    });

  });

// auto refresh tiap 30 detik
setTimeout(() => location.reload(), 30000);
</script>
